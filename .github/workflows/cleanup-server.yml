name: Cleanup Server .env

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Cleanup corrupted .env file
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd ~/apps/turismo-pwa

            echo "Current .env status:"
            ls -la .env 2>/dev/null || echo ".env does not exist"

            echo "Backing up current .env..."
            if [ -f .env ]; then
              mv .env .env.backup.$(date +%Y%m%d_%H%M%S)
            fi

            echo "Creating clean .env file..."
            echo "BLUE_TAG=latest" > .env
            echo "GREEN_TAG=latest" >> .env
            echo "ACTIVE_ENV=blue" >> .env

            echo "New .env created:"
            cat .env

            echo "Cleanup complete!"
